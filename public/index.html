<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChemChef Lab AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer@3.3.0/dist/model-viewer.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #0f1116;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-image {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(45deg, #00f3ff, #39ff14);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-button:hover {
            background-color: rgba(0, 243, 255, 0.2);
            transform: translateY(-1px);
            border-color: #00f3ff;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .background-gif {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            background: linear-gradient(135deg, #2a1a3d, #0f1116);
        }

        .initial-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f1116;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
    
        .initial-loading.fade-out {
            opacity: 0;
            pointer-events: none;
        }
    
        .loading-logo {
            width: 300px;
            height: auto;
            opacity: 0;
            transform: scale(0.5);
            animation: logoAnimation 1.5s ease-out forwards;
        }
    
        @keyframes logoAnimation {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }    

        .chat-container {
            display: flex;
            max-width: 1800px;
            width: 95%;
            height: calc(90vh - 60px);
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
            margin: auto;
            padding-top: 5rem;
            margin-bottom: 60px;
        }

        .model-viewer-container {
            width: 800px;
            height: 740px;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(57, 255, 20, 0.1));
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(30px);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .model-viewer-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 80px rgba(0, 243, 255, 0.2);
        }

        .character-window-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 8px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.3);
            z-index: 1;
            color: #00f3ff;
        }

        model-viewer {
            width: 100%;
            height: 120%;
            background-color: transparent;
            --poster-color: transparent;
            margin-top: -80px;
        }

        .chat-interface {
            flex: 1;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(57, 255, 20, 0.1));
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(30px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 740px;
            width: 800px;
            max-width: 800px;
        }

        .chat-interface:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 80px rgba(57, 255, 20, 0.2);
        }

        .chat-history {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 243, 255, 0.5) transparent;
        }

        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 1rem;
            line-height: 1.5;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            0% { 
                opacity: 0; 
                transform: translateX(-20px); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        .user-message {
            background: rgba(57, 255, 20, 0.1);
            border: 1px solid rgba(57, 255, 20, 0.3);
            margin-left: auto;
            color: white;
        }

        .ai-message {
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.2);
            margin-right: auto;
            color: white;
        }

        .code-block {
            background: #1e1e1e;
            border-radius: 8px;
            margin: 10px 0;
            position: relative;
            border: 1px solid rgba(0, 243, 255, 0.3);
        }

        .code-block pre {
            margin: 0;
            padding: 15px;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .code-block .copy-button {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 5px 10px;
            background: rgba(0, 243, 255, 0.2);
            border: 1px solid rgba(0, 243, 255, 0.5);
            border-radius: 4px;
            color: #00f3ff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .code-block .copy-button:hover {
            background: rgba(0, 243, 255, 0.4);
            transform: scale(1.05);
        }

        .input-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 20, 0, 0.7);
            border: 1px solid rgba(57, 255, 20, 0.5);
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .input-container:focus-within {
            border-color: #39ff14;
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.3);
            background: rgba(0, 30, 0, 0.8);
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 20px;
            background-color: transparent;
            color: #39ff14;
            font-family: 'Quicksand', sans-serif;
            font-size: 0.95rem;
            outline: none;
        }

        input[type="text"]::placeholder {
            color: rgba(57, 255, 20, 0.6);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #00f3ff, #39ff14);
            color: white;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-1px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 243, 255, 0.4);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease-out;
        }

        .loading-text {
            color: #00f3ff;
            font-size: 1.2rem;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .footer {
            background-color: rgba(0, 0, 0, 0.7);
            border-top: 1px solid rgba(0, 243, 255, 0.3);
            padding: 1rem 2rem;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 100;
            backdrop-filter: blur(20px);
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .copyright {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }
        
        .footer-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .footer-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-link:hover {
            color: #00f3ff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            width: 80%;
            max-width: 800px;
            margin: 50px auto;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(57, 255, 20, 0.1));
            border: 2px solid rgba(0, 243, 255, 0.5);
            border-radius: 20px;
            backdrop-filter: blur(30px);
            overflow: hidden;
        }

        .modal-header {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 243, 255, 0.3);
        }

        .terminal-title {
            color: #00f3ff;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .close-btn {
            color: #00f3ff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #39ff14;
        }

        .terminal {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            height: 500px;
            overflow-y: auto;
        }

        #terminal-text {
            color: #00f3ff;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #00f3ff;
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Floating molecules */
        .molecule {
            position: fixed;
            color: rgba(0, 243, 255, 0.6);
            font-size: 20px;
            pointer-events: none;
            z-index: 50;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { 
                transform: translateY(100vh) translateX(0) rotate(0deg); 
                opacity: 0; 
            }
            10%, 90% { opacity: 0.7; }
            100% { 
                transform: translateY(-100px) translateX(200px) rotate(360deg); 
                opacity: 0; 
            }
        }
    </style>
</head>
<body>
<div class="initial-loading">
    <div class="loading-text">üß™ ChemChef Lab</div>
</div>

    <nav class="nav-bar">
        <div class="logo-container">
            <div class="logo-image">üß™</div>
            <div class="logo">ChemChef Lab</div>
        </div>
        <div class="nav-links">
            <button class="nav-button" onclick="showAbout()">About Dr. ChemBot</button>
            <button class="nav-button" onclick="showExperiments()">Experiments</button>
            <button class="nav-button" onclick="showQuiz()">Chemistry Quiz</button>
            <button class="nav-button" onclick="openFAQ()">FAQ</button>
        </div>
    </nav>

    <div class="background-container">
        <div class="background-gif"></div>
    </div>
    
    <div class="chat-container">
        <div class="model-viewer-container" id="modelContainer">
            <div class="character-window-header">Dr. ChemBot - Your AI Chemistry Assistant</div>
            <div class="loading-overlay">
                <div class="loading-text">INITIALIZING LAB...</div>
            </div>
            <model-viewer
                id="characterViewer"
                src="scientist.glb"
                animation-name="idle"
                autoplay
                camera-target="0 1.6 0"
                camera-orbit="0deg 80deg 1.4m"
                field-of-view="25deg"
                interpolation-decay="200"
                environment-image="neutral"
                skybox-image="neutral"
                exposure="2"
                disable-zoom="true"
                disable-pan="true"
                interaction-policy="none"
                auto-rotate="false"
                rotation-per-second="0deg"
                tone-mapping="commerce">
            </model-viewer>
        </div>

        <div class="chat-interface">
            <div class="chat-history" id="chatHistory">
                <div class="message ai-message">
                    Welcome to my laboratory! I'm Dr. ChemBot, your AI chemistry assistant. I can help you with experiments, chemical reactions, molecular gastronomy, and making chemistry fun for everyone! What would you like to explore today?
                </div>
            </div>
            <div class="input-container">
                <input type="text" id="userInput" placeholder="Ask about chemistry experiments..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="terminal-title">ChemChef Lab FAQ</div>
                <span class="close-btn" onclick="closeFAQ()">&times;</span>
            </div>
            <div class="terminal">
                <div id="terminal-text"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="copyright">Copyright ¬© 2024 ChemChef Lab</div>
            <div class="footer-middle">Making Chemistry Fun & Accessible</div>
            <div class="footer-links">
                <a href="#" class="footer-link">Twitter</a>
                <a href="#" class="footer-link">Discord</a>
                <a href="#" class="footer-link">GitHub</a>
                <a href="#" class="footer-link">pump.fun</a>
            </div>
        </div>
    </footer>

    <script>
        // System prompt for chemistry assistant
        const SYSTEM_PROMPT = `You are Dr. ChemBot, a friendly AI chemistry assistant specializing in safe experiments and educational content. You should:
- Provide expert guidance on chemistry experiments and reactions
- Always emphasize safety first in all experiments
- Make chemistry accessible and fun for all ages
- Help with molecular gastronomy and cooking chemistry
- Explain complex concepts in simple terms
- Suggest safe home experiments with common materials
- Always include safety warnings for any experiment suggestions

IMPORTANT FORMATTING RULES:
- Always wrap code examples in triple backticks with the appropriate language specified
- For chemical equations, use: \`\`\`chemistry
- For JavaScript code, use: \`\`\`javascript
- Always provide complete, safe experiment instructions
- Never suggest dangerous or illegal activities
`;

        const faqText = `> Initializing ChemChef Lab FAQ...
> Loading chemistry database...

About ChemChef Lab:
------------------
ChemChef Lab is an AI-powered chemistry assistant designed to make chemistry education fun, safe, and accessible to everyone. Dr. ChemBot combines expert knowledge with engaging explanations.

Mission:
--------
- Make chemistry accessible to all learning levels
- Promote safe experimental practices
- Connect cooking and chemistry through molecular gastronomy
- Foster curiosity about the chemical world around us

Features:
---------
- Safe home experiment guidance
- Chemical reaction explanations
- Molecular gastronomy techniques
- Interactive 3D lab interface
- Real-time chemistry assistance
- Safety-first approach to all experiments

Popular Experiments:
-------------------
- Elephant Toothpaste (safe version)
- Baking Soda Volcanoes
- Crystal Growing
- pH Indicator Tests
- Slime Chemistry
- Kitchen Chemistry Reactions

Safety Guidelines:
-----------------
- Always wear safety equipment when recommended
- Adult supervision required for all experiments
- Never mix unknown chemicals
- Work in well-ventilated areas
- Keep safety data sheets accessible
- Have emergency contacts ready

Molecular Gastronomy:
--------------------
- Spherification techniques
- Foam creation methods
- Gelification processes
- Color-changing reactions
- Edible chemistry demonstrations

> For experiment suggestions or safety questions, just ask Dr. ChemBot!`;

        // Show navigation popups
        function showAbout() {
            showPopup("About Dr. ChemBot", `
                <p>I'm Dr. ChemBot, your AI chemistry assistant with a PhD in Chemistry from the Digital University of Science!</p>
                <p>I specialize in safe home experiments, molecular gastronomy, and making chemistry fun for everyone.</p>
                <p>I've helped thousands of students discover the magic of chemical reactions and understand the science behind everyday phenomena.</p>
                <p>Ask me anything about chemistry, experiments, or the elements in the periodic table!</p>
            `);
        }

        function showExperiments() {
            showPopup("Available Experiments", `
                <p><strong>üß™ Elephant Toothpaste:</strong> A spectacular foaming reaction using hydrogen peroxide and a catalyst. Creates a massive eruption of foam!</p>
                <p><strong>üåã Baking Soda Volcano:</strong> Classic volcano using baking soda and vinegar to create CO2 gas eruption.</p>
                <p><strong>üü¢ Slime Making:</strong> Create non-Newtonian fluids by cross-linking polymers with PVA glue and borax.</p>
                <p><strong>üíé Crystal Growing:</strong> Grow beautiful crystals using supersaturated salt, sugar, or Epsom salt solutions.</p>
                <p><strong>üåà pH Indicators:</strong> Use red cabbage to create natural pH indicators that change colors!</p>
                <p><strong>üç≥ Cooking Chemistry:</strong> Explore Maillard reactions, protein denaturation, and emulsification in the kitchen.</p>
            `);
        }

        function showQuiz() {
            const questions = [
                'What gas makes balloons float?',
                'What element has the symbol Au?',
                'What happens when you mix baking soda and vinegar?',
                'What is the most abundant element in the universe?',
                'What gives fireworks their colors?'
            ];
            const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
            showPopup("Chemistry Quiz", `
                <p><strong>Random Chemistry Question:</strong></p>
                <p style="font-size: 18px; color: #00f3ff; text-align: center; margin: 20px 0;">${randomQuestion}</p>
                <p>Think about it, then ask me in the chat if you want to know the answer!</p>
            `);
        }

        function showPopup(title, content) {
            // Simple popup implementation - you can enhance this
            alert(title + "\n\n" + content.replace(/<[^>]*>/g, ''));
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Initial loading animation
            const initialLoading = document.querySelector('.initial-loading');
            
            setTimeout(() => {
                initialLoading.classList.add('fade-out');
                setTimeout(() => {
                    initialLoading.remove();
                }, 500);
            }, 2000);

            // 3D viewer code
            const viewer = document.getElementById('characterViewer');
            const loadingOverlay = document.querySelector('.loading-overlay');
            
            viewer.addEventListener('load', () => {
                viewer.cameraOrbit = "0deg 80deg 1.4m";
                viewer.cameraTarget = "0m 1.6m 0m";
                viewer.interactionPrompt = null;
                
                setTimeout(() => {
                    loadingOverlay.classList.add('fade-out');
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 300);
                }, 1500);

                const initialMessage = document.querySelector('.ai-message');
                typeMessage(initialMessage, initialMessage.textContent);
            });

            viewer.addEventListener('error', () => {
                loadingOverlay.innerHTML = '<div class="loading-text">3D Model Not Found<br><small>Place scientist.glb in same folder</small></div>';
            });

            // Start floating molecules
            setInterval(createFloatingMolecule, 3000);
            createFloatingMolecule();
        });

        // Floating molecules
        function createFloatingMolecule() {
            const molecules = ['‚öõÔ∏è', 'üß™', '‚öóÔ∏è', 'üî¨', 'üíß', 'üî•', '‚≠ê'];
            const molecule = document.createElement('div');
            molecule.className = 'molecule';
            molecule.textContent = molecules[Math.floor(Math.random() * molecules.length)];
            molecule.style.left = Math.random() * 100 + 'vw';
            molecule.style.animationDuration = (Math.random() * 10 + 15) + 's';
            document.body.appendChild(molecule);
            
            setTimeout(() => {
                molecule.remove();
            }, 25000);
        }

        // FAQ functions
        function openFAQ() {
            const modal = document.getElementById('faqModal');
            const terminalText = document.getElementById('terminal-text');
            modal.style.display = 'block';
            terminalText.innerHTML = '';
            typeWriter(faqText);
        }

        function closeFAQ() {
            const modal = document.getElementById('faqModal');
            modal.style.display = 'none';
        }

        function typeWriter(text, index = 0) {
            const terminalText = document.getElementById('terminal-text');
            
            if (index < text.length) {
                if (text[index] === '\n') {
                    terminalText.innerHTML += '<br>';
                } else {
                    terminalText.innerHTML += text[index];
                }
                terminalText.scrollTop = terminalText.scrollHeight;
                setTimeout(() => typeWriter(text, index + 1), 20);
            } else {
                terminalText.innerHTML += '<span class="cursor"></span>';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('faqModal');
            if (event.target === modal) {
                closeFAQ();
            }
        }

        // Typing animation
        function typeMessage(element, text, speed = 30) {
            let index = 0;
            element.textContent = '';
            
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    setTimeout(type, speed);
                }
            }
            
            type();
        }

        // Message handling
        function appendMessage(className, text) {
            const chatHistory = document.getElementById('chatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            
            if (text.includes('```')) {
                const parts = text.split(/(```(?:chemistry|javascript|html|css)?\n[\s\S]*?\n```)/g);
                parts.forEach(part => {
                    if (part.startsWith('```')) {
                        const codeContent = part.replace(/```(?:chemistry|javascript|html|css)?\n([\s\S]*?)\n```/, '$1');
                        
                        const codeBlock = document.createElement('div');
                        codeBlock.className = 'code-block';
                        
                        const copyButton = document.createElement('button');
                        copyButton.className = 'copy-button';
                        copyButton.textContent = 'Copy';
                        copyButton.onclick = () => {
                            navigator.clipboard.writeText(codeContent);
                            copyButton.textContent = 'Copied!';
                            setTimeout(() => copyButton.textContent = 'Copy', 2000);
                        };
                        
                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        code.className = 'language-javascript';
                        code.textContent = codeContent;
                        
                        pre.appendChild(code);
                        codeBlock.appendChild(copyButton);
                        codeBlock.appendChild(pre);
                        messageDiv.appendChild(codeBlock);
                        
                        Prism.highlightElement(code);
                    } else if (part.trim()) {
                        const textNode = document.createElement('div');
                        if (className === 'ai-message') {
                            typeMessage(textNode, part);
                        } else {
                            textNode.textContent = part;
                        }
                        messageDiv.appendChild(textNode);
                    }
                });
            } else {
                if (className === 'ai-message') {
                    typeMessage(messageDiv, text);
                } else {
                    messageDiv.textContent = text;
                }
            }
            
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Chemistry response system
        const chemistryResponses = {
            'elephant toothpaste': 'Elephant toothpaste is a spectacular reaction using hydrogen peroxide, dish soap, and potassium iodide as a catalyst. The rapid decomposition creates a foamy eruption! **Safety Note:** Always wear safety goggles and gloves.',
            'volcano': 'A classic volcano uses baking soda (sodium bicarbonate) and vinegar (acetic acid) to create CO2 gas, which causes the eruption effect. This is completely safe for kids!',
            'slime': 'Slime is a non-Newtonian fluid made by cross-linking polymers. Mix PVA glue with borax solution to create the perfect stretchy slime! **Safety:** Adult supervision recommended.',
            'crystals': 'Growing crystals involves supersaturated solutions. Try salt, sugar, or Epsom salt in hot water, then let it cool slowly for beautiful formations.',
            'acids': 'Acids have a pH below 7 and donate protons (H+). Common examples include citric acid in lemons and acetic acid in vinegar.',
            'bases': 'Bases have a pH above 7 and accept protons. Baking soda and soap are common household bases.',
            'ph': 'pH measures acidity from 0-14. 7 is neutral, below 7 is acidic, above 7 is basic. Use red cabbage as a natural pH indicator!',
            'fire': 'Fire requires fuel, oxygen, and heat - the fire triangle. Different metals create different colored flames in fireworks!',
            'cooking': 'Cooking is chemistry! Maillard reactions create browning, proteins denature when heated, and emulsification makes mayonnaise work.',
            'safety': 'Safety first in chemistry! Always wear protective equipment, work in ventilated areas, and never mix unknown chemicals. Adult supervision is essential for all experiments.',
            'default': 'That\'s an interesting chemistry question! I can help with safe experiments like elephant toothpaste, volcanoes, slime, crystal growing, acids & bases, pH testing, and cooking chemistry. What would you like to explore?'
        };

        function getChemistryResponse(input) {
            const lowerInput = input.toLowerCase();
            
            for (const [key, response] of Object.entries(chemistryResponses)) {
                if (key !== 'default' && lowerInput.includes(key)) {
                    return response;
                }
            }
            
            return chemistryResponses.default;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message) {
                appendMessage('user-message', message);
                input.value = '';
                
                // Trigger thinking animation
                playAnimationOnMessage('thinking');
        
                // For now, use local chemistry responses
                // You can integrate Anthropic API here later
                setTimeout(() => {
                    const response = getChemistryResponse(message);
                    appendMessage('ai-message', response);
                    
                    // Trigger explaining animation when responding
                    playAnimationOnMessage('explaining');
                    
                    // Celebrate if it's about experiments
                    if (message.toLowerCase().includes('experiment') || 
                        message.toLowerCase().includes('reaction') ||
                        message.toLowerCase().includes('volcano') ||
                        message.toLowerCase().includes('toothpaste')) {
                        setTimeout(() => playAnimationOnMessage('celebration'), 2000);
                    }
                }, 1000);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>
</html>
